<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Verda4Garden ‚Äì Pets, Sheckles & Sprinkler Available</title>
<link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  /* Base & Layout Styles */
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #f8f5f0;
    margin: 0; padding: 0; color: #444;
    line-height: 1.6;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark-mode {
    background: #222;
    color: #eee;
  }
  body.dark-mode header {
    background: linear-gradient(to right, #333, #444);
    color: #eee;
    border-bottom: 3px solid #555;
  }
  body.dark-mode .container {
    background: #333;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
  }
  body.dark-mode h3 {
    color: #a0a0a0;
  }
  body.dark-mode .pet-item, body.dark-mode .bundle-item, body.dark-mode .recommended-item {
    background: #444;
    color: #ddd;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  }
  body.dark-mode .pet-item:hover, body.dark-mode .recommended-item:hover {
    background-color: #555; /* Darker hover for dark mode */
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  }
  body.dark-mode .bundle-item:hover {
    background-color: #5a6b5a; /* Darker hover for dark mode bundle */
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  }
  body.dark-mode .pet-info strong {
    color: #ccc;
  }
  body.dark-mode .bundle-name {
    color: #eee;
  }
  body.dark-mode .bundle-price {
    color: #90ee90;
  }
  body.dark-mode #cartPanel, body.dark-mode #historyPanel {
    background: #333;
    box-shadow: -3px 0 15px rgba(0,0,0,0.3);
  }
  body.dark-mode .cart-item, body.dark-mode .history-item {
    border-bottom: 1px solid #555;
  }
  body.dark-mode .cart-item-name {
    color: #ccc;
  }
  body.dark-mode #cartTotal, body.dark-mode #discountDisplay {
    color: #eee;
  }
  body.dark-mode #checkoutForm label {
    color: #ccc;
  }
  body.dark-mode #checkoutForm input,
  body.dark-mode #checkoutForm textarea,
  body.dark-mode #checkoutForm select {
    background: #555;
    color: #eee;
    border: 1px solid #666;
  }
  body.dark-mode #checkoutForm input::placeholder,
  body.dark-mode #checkoutForm textarea::placeholder {
    color: #aaa;
  }
  body.dark-mode #langSelector, body.dark-mode #darkModeToggle {
    background: #555;
    color: #eee;
    border: 1px solid #666;
  }
  body.dark-mode .cart-item-controls button {
    background: #666;
  }
  body.dark-mode .cart-item-controls button:disabled {
    background: #888;
  }
  body.dark-mode .faq-item, body.dark-mode .testimonial-item {
    background: #444;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  body.dark-mode .faq-question { /* FIX: FAQ question text in dark mode */
    color: #eee;
    background-color: #555;
  }
  body.dark-mode .faq-answer { /* FIX: FAQ answer text in dark mode */
    background-color: #4a4a4a;
    color: #ddd;
  }
  body.dark-mode .social-media a, body.dark-mode .footer-section a {
    color: #eee;
  }
  body.dark-mode .skeleton-item {
    background-color: #4a4a4a;
  }
  body.dark-mode .skeleton-item .skeleton-line,
  body.dark-mode .skeleton-item .skeleton-icon {
    background-color: #666666;
  }
  body.dark-mode .modal-content {
    background-color: #333;
    color: #eee;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
  }
  body.dark-mode .modal-content h2 {
    color: #eee;
  }
  body.dark-mode .modal-content p {
    color: #ddd;
  }
  body.dark-mode .modal-content button {
    background-color: #666;
    color: #eee;
  }
  body.dark-mode .modal-content button:hover {
    background-color: #777;
  }
  body.dark-mode .rarity-buttons button {
    background-color: #555;
    color: #eee;
    border: 1px solid #666;
  }
  body.dark-mode .rarity-buttons button.active {
    background-color: #2a6b2a;
    border-color: #2a6b2a;
    color: white;
  }
  body.dark-mode .toast-notification {
    background-color: #4a4a4a;
    color: #eee;
    box-shadow: 0 2px 10px rgba(0,0,0,0.5);
  }
  body.dark-mode .footer-section {
    background-color: #2a2a2a;
    color: #bbb;
    border-top: 1px solid #555;
  }
  body.dark-mode .footer-section h4 {
    color: #eee;
  }
  body.dark-mode #backToTopBtn {
    background-color: #555;
    color: #eee;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }
  body.dark-mode #backToTopBtn:hover {
    background-color: #666;
  }

  header {
    background: linear-gradient(to right, #e8dcc9, #f4ede3);
    padding: 30px;
    text-align: center;
    font-size: 28px;
    font-weight: 700;
    color: #5a4b3b;
    border-bottom: 3px solid #e1d4be;
    user-select: none;
    position: sticky;
    top: 0;
    z-index: 10000;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 15px;
    box-sizing: border-box;
    min-height: 80px;
  }
  #langSelector, #darkModeToggle {
    position: static;
    margin: 5px 0;
    padding: 6px 10px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
    background-color: #fff;
    cursor: pointer;
    flex-shrink: 0;
  }
  .container {
    max-width: 960px;
    margin: 30px auto 60px;
    padding: 30px;
    background: #fffaf3;
    border-radius: 14px;
    box-shadow: 0 0 20px rgba(0,0,0,0.07);
  }
  h3 {
    color: #7a614c;
    margin-top: 30px;
    margin-bottom: 16px;
    font-weight: 700;
    text-align: center;
  }
  .product-section-header {
    display: flex;
    flex-direction: column; /* Changed to column for better mobile layout */
    align-items: center;
    gap: 15px; /* Spacing between title and filters */
    margin-bottom: 20px;
  }
  .product-section-header h3 {
    margin: 0; /* Reset margin from general h3 rule */
  }
  .filter-controls {
    display: flex;
    flex-wrap: wrap; /* Allow wrapping for rarity buttons */
    gap: 10px;
    justify-content: center;
  }
  .filter-controls input, .filter-controls select {
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  .rarity-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
    margin-top: 10px;
  }
  .rarity-buttons button {
    padding: 8px 12px;
    border: 1px solid #c9c9c9;
    border-radius: 8px;
    background-color: #f0f0f0;
    color: #555;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s ease;
  }
  .rarity-buttons button:hover {
    background-color: #e0e0e0;
    border-color: #bbb;
  }
  .rarity-buttons button.active {
    background-color: #25d366;
    color: white;
    border-color: #25d366;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(37, 211, 102, 0.3);
  }

  .pet-list, .sheckles-list, .sprinkler-list, .bundle-list, .recommended-list {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
  }
  .pet-item, .recommended-item {
    background: #fef7ee;
    padding: 18px 22px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    font-size: 16px;
    color: #5a4b3b;
    cursor: pointer;
    flex: 1 1 260px;
    max-width: 300px;
    display: flex;
    align-items: flex-start;
    gap: 14px;
    transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
    user-select: none;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  .pet-item:hover, .recommended-item:hover {
    transform: translateY(-6px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    background-color: #fcefdc;
  }
  .pet-icon {
    font-size: 48px;
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    flex-shrink: 0;
  }
  .pet-icon img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    border-radius: 8px;
  }
  .pet-info {
    flex-grow: 1;
    text-align: center;
  }
  .pet-info strong {
    color: #a0683c;
    font-size: 18px;
    display: block;
    margin-bottom: 6px;
  }
  .pet-info p {
    font-size: 14px;
    margin: 0;
    line-height: 1.4;
  }
  .rarity-label { /* Styling for pet rarity labels */
    font-size: 0.9em;
    padding: 2px 6px;
    border-radius: 4px;
    margin-left: 8px;
    font-weight: bold;
    color: white;
    display: inline-block;
    vertical-align: middle;
  }

  /* Rarity Colors (adjust as needed) */
  .rarity-Divine { background-color: #ffc107; color: #8B4513; } /* Gold */
  .rarity-Mythical { background-color: #9c27b0; } /* Purple */
  .rarity-Legendary { background-color: #2196f3; } /* Blue */
  .rarity-Rare { background-color: #4caf50; } /* Green */
  .rarity-Night { background-color: #616161; } /* Dark Gray */
  .rarity-Paradise { background-color: #ff9800; } /* Orange */

  /* Cart Panel */
  #cartPanel {
    position: fixed;
    top: 80px;
    right: 0;
    width: 320px;
    height: 90vh;
    background: #fffaf3;
    box-shadow: -3px 0 15px rgba(0,0,0,0.1);
    border-radius: 14px 0 0 14px;
    padding: 20px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    user-select: none;
    transform: translateX(100%);
    transition: transform 0.3s ease;
    z-index: 10000;
    overflow-y: auto;
  }
  #cartPanel.open {
    transform: translateX(0);
  }
  #cartToggleBtn {
    position: fixed;
    top: 90px;
    right: 320px;
    background: #25d366;
    color: white;
    border: none;
    border-radius: 12px 0 0 12px;
    padding: 10px 18px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    user-select: none;
    transition: background-color 0.2s ease;
    z-index: 10001;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  #cartToggleBtn:hover {
    background: #20b858;
  }
  #cartItemCount {
    background: #e94b35;
    color: white;
    border-radius: 50%;
    padding: 2px 8px;
    font-size: 14px;
    font-weight: bold;
    min-width: 25px;
    text-align: center;
  }
  #cartPanel h3 {
    margin: 0 0 16px 0;
    color: #7a614c;
    font-size: 22px;
    text-align: center;
  }
  #cartItems {
    flex-grow: 1;
    overflow-y: auto;
    margin-bottom: 16px;
  }
  .cart-item {
    border-bottom: 1px solid #e0d4c2;
    padding: 8px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .cart-item-info {
    flex-grow: 1;
  }
  .cart-item-name {
    font-weight: 700;
    color: #a0683c;
  }
  .cart-item-controls {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .cart-item-controls button {
    background: #a0683c;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 4px 8px;
    cursor: pointer;
    font-weight: 700;
  }
  .cart-item-controls button:disabled {
    background: #e0d4c2;
    cursor: not-allowed;
  }
  #cartTotal, #discountDisplay {
    font-weight: 700;
    font-size: 18px;
    color: #5a4b3b;
    text-align: right;
    margin-bottom: 8px;
  }
  #checkoutForm {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  #checkoutForm label {
    font-weight: 600;
    color: #5a4b3b;
  }
  #checkoutForm input, #checkoutForm textarea, #checkoutForm select {
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
    resize: vertical;
  }
  #checkoutBtn {
    background: #25d366;
    color: white;
    border: none;
    border-radius: 12px;
    padding: 12px;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  #checkoutBtn:disabled {
    background: #b2ddb0;
    cursor: not-allowed;
  }
  #checkoutBtn:hover:not(:disabled) {
    background: #20b858;
  }
  .error {
    border-color: #e94b35;
  }
  .error-message {
    font-size: 12px;
    color: #e94b35;
    display: none;
    margin-top: -8px;
    margin-bottom: 4px;
  }

  /* History Panel */
  #historyPanel {
    position: fixed;
    top: 80px;
    right: 340px;
    width: 320px;
    max-height: 90vh;
    background: #fffaf3;
    box-shadow: -3px 0 15px rgba(0,0,0,0.1);
    border-radius: 14px 0 0 14px;
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
    display: none;
    flex-direction: column;
    user-select: none;
    z-index: 10000;
  }
  #historyPanel.open {
    display: flex;
  }
  #historyPanel h3 {
    margin: 0 0 16px 0;
    color: #7a614c;
    font-size: 22px;
    text-align: center;
  }
  #historyItems .history-item {
    border-bottom: 1px solid #e0d4c2;
    padding: 10px 0;
    font-size: 14px;
    color: #5a4b3b;
  }
  #historyToggleBtn {
    position: fixed;
    top: 90px;
    right: 640px;
    background: #3a3a3a;
    color: white;
    border: none;
    border-radius: 12px 0 0 12px;
    padding: 10px 18px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    user-select: none;
    transition: background-color 0.2s ease;
    z-index: 10001;
  }
  #historyToggleBtn:hover {
    background: #1f1f1f;
  }

  /* Bundle list styling */
  .bundle-item {
    background: #dce9d9;
    padding: 18px 22px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    font-size: 16px;
    color: #3a503a;
    cursor: pointer;
    flex: 1 1 280px;
    max-width: 320px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    user-select: none;
    transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
  }
  .bundle-item:hover {
    transform: translateY(-6px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    background-color: #e4f0e1;
  }
  .bundle-name {
    font-weight: 700;
    font-size: 20px;
  }
  .bundle-desc {
    font-size: 14px;
    color: #2f452f;
    white-space: pre-wrap;
  }
  .bundle-price {
    font-weight: 700;
    font-size: 18px;
    color: #2a6b2a;
    margin-top: auto;
  }

  /* FAQ & Testimonials */
  .faq-item {
    background: #fef7ee;
    border-radius: 10px;
    margin-bottom: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    overflow: hidden; /* Ensure content is hidden when collapsed */
  }
  .faq-question {
    padding: 15px 20px;
    font-weight: 700;
    color: #7a614c;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #fef7ee;
    transition: background-color 0.2s ease;
  }
  .faq-question:hover {
    background-color: #fcefdc;
  }
  .faq-question .toggle-icon {
    font-size: 1.2em;
    transition: transform 0.2s ease;
  }
  .faq-question.active .toggle-icon {
    transform: rotate(180deg);
  }
  .faq-answer {
    padding: 0 20px; /* Initial padding, will be animated */
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out, padding 0.3s ease-out;
    background-color: #fffaf3;
  }
  .faq-answer.open {
    max-height: 200px; /* Adjust as needed for max content */
    padding: 15px 20px;
  }
  .faq-answer p {
    margin: 0;
    color: #5a4b3b;
  }

  .testimonial-item {
    background: #fef7ee;
    padding: 15px 20px;
    border-radius: 10px;
    margin-bottom: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }
  .testimonial-item blockquote {
    margin: 0 0 10px 0;
    font-style: italic;
    color: #5a4b3b;
  }
  .testimonial-item cite {
    display: block;
    text-align: right;
    font-size: 0.9em;
    color: #888;
  }

  /* Social Media Section */
  .social-media {
    text-align: center;
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid #e0d4c2;
  }
  .social-media h3 {
    margin-bottom: 20px;
  }
  .social-icons {
    display: flex;
    justify-content: center;
    gap: 25px;
  }
  .social-media a {
    color: #7a614c;
    font-size: 36px;
    text-decoration: none;
    transition: color 0.2s ease, transform 0.2s ease;
  }
  .social-media a:hover {
    color: #a0683c;
    transform: translateY(-3px);
  }

  /* Add to Cart Confirmation Pop-up */
  .add-to-cart-popup {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #25d366;
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    z-index: 100000;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .add-to-cart-popup.show {
    opacity: 1;
    visibility: visible;
  }
  .add-to-cart-popup .icon {
    font-size: 24px;
  }

  /* Flying item animation */
  .flying-item {
      position: fixed;
      font-size: 30px;
      z-index: 1000000;
      pointer-events: none;
      opacity: 1;
      transition: all 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  }

  /* Skeleton Loading */
  .skeleton-item {
    background-color: #e0e0e0;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    flex: 1 1 260px;
    max-width: 300px;
    padding: 18px 22px;
    display: flex;
    flex-direction: column;
    gap: 14px;
    animation: pulse 1.5s infinite ease-in-out;
  }
  .skeleton-item.bundle {
      flex: 1 1 280px;
      max-width: 320px;
  }
  .skeleton-item .skeleton-line {
    background-color: #cccccc;
    height: 1em;
    border-radius: 4px;
  }
  .skeleton-item .skeleton-icon {
    background-color: #cccccc;
    width: 64px;
    height: 64px;
    border-radius: 8px;
    margin: 0 auto;
  }
  .skeleton-item .skeleton-line.title {
    width: 80%;
    height: 1.2em;
    margin: 0 auto;
  }
  .skeleton-item .skeleton-line.desc {
    width: 95%;
    margin: 0 auto;
  }
  .skeleton-item .skeleton-line.price {
    width: 50%;
    height: 1.2em;
    margin: 0 auto;
  }


  @keyframes pulse {
    0% { opacity: 0.7; }
    50% { opacity: 1; }
    100% { opacity: 0.7; }
  }

  /* Modal (Product Detail Pop-up) */
  .modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 100000; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  .modal.show {
    opacity: 1;
    visibility: visible;
  }

  .modal-content {
    background-color: #fef7ee;
    margin: auto;
    padding: 30px;
    border-radius: 15px;
    width: 80%;
    max-width: 500px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    position: relative;
    text-align: center;
    transform: scale(0.9);
    transition: transform 0.3s ease;
  }
  .modal.show .modal-content {
    transform: scale(1);
  }

  .modal-content .close-button {
    color: #aaa;
    position: absolute;
    top: 15px;
    right: 25px;
    font-size: 36px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.2s;
  }
  .modal-content .close-button:hover,
  .modal-content .close-button:focus {
    color: #777;
    text-decoration: none;
    cursor: pointer;
  }
  .modal-content h2 {
    margin-top: 0;
    color: #7a614c;
    font-size: 28px;
    margin-bottom: 15px;
  }
  .modal-content .modal-icon {
    font-size: 70px;
    margin-bottom: 15px;
  }
  .modal-content p {
    font-size: 16px;
    margin-bottom: 20px;
    color: #5a4b3b;
  }
  .modal-content .modal-price {
    font-size: 22px;
    font-weight: bold;
    color: #a0683c;
    margin-bottom: 25px;
  }
  .modal-content button {
    background-color: #25d366;
    color: white;
    padding: 12px 25px;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  .modal-content button:hover {
    background-color: #20b858;
  }

  /* Checkout progress */
  .checkout-progress {
    text-align: center;
    margin-top: 20px;
    padding: 15px;
    background-color: #e6f7ff;
    border: 1px solid #91d5ff;
    border-radius: 8px;
    font-size: 15px;
    color: #1890ff;
    display: none; /* Hidden by default */
  }
  .checkout-progress.show {
    display: block;
  }
  body.dark-mode .checkout-progress {
    background-color: #1f3a4d;
    border-color: #3b749e;
    color: #8ac0e2;
  }

  /* Toast Notification */
  .toast-notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #333;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out, visibility 0.3s ease-in-out;
    z-index: 100001;
    min-width: 200px;
    text-align: center;
    transform: translateY(20px);
  }
  .toast-notification.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  /* Footer */
  .footer-section {
    background-color: #f4ede3;
    padding: 40px 20px;
    margin-top: 50px;
    border-top: 1px solid #e1d4be;
    color: #5a4b3b;
    text-align: center;
  }
  .footer-section .footer-columns {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    gap: 30px;
    max-width: 960px;
    margin: 0 auto;
  }
  .footer-column {
    flex: 1 1 250px;
    min-width: 200px;
  }
  .footer-column h4 {
    color: #7a614c;
    margin-bottom: 15px;
    font-size: 1.2em;
  }
  .footer-column ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .footer-column ul li {
    margin-bottom: 8px;
  }
  .footer-column ul li a {
    color: #5a4b3b;
    text-decoration: none;
    transition: color 0.2s ease;
  }
  .footer-column ul li a:hover {
    color: #a0683c;
  }
  .footer-bottom {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #e0d4c2;
    font-size: 0.9em;
    color: #888;
  }

  /* Back to Top Button */
  #backToTopBtn {
    display: none; /* Hidden by default */
    position: fixed; /* Fixed/sticky position */
    bottom: 30px; /* Place the button at the bottom of the page */
    right: 30px; /* Place the button at the right of the page */
    z-index: 9999; /* Make sure it does not overlap */
    border: none; /* Remove borders */
    outline: none; /* Remove outline */
    background-color: #a0683c; /* Set a background color */
    color: white; /* Text color */
    cursor: pointer; /* Add a mouse pointer on hover */
    padding: 12px 16px; /* Some padding */
    border-radius: 10px; /* Rounded corners */
    font-size: 18px; /* Increase font size */
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    transition: background-color 0.3s, transform 0.2s ease;
  }

  #backToTopBtn:hover {
    background-color: #855b33; /* Darker background on hover */
    transform: translateY(-2px);
  }


  /* Responsive */
  @media (max-width: 700px) {
    header {
      padding: 20px;
      flex-direction: column;
      gap: 10px;
      font-size: 24px;
    }
    #langSelector, #darkModeToggle {
      width: calc(100% - 20px);
    }

    #cartPanel, #historyPanel {
      width: 100%;
      height: 60vh;
      bottom: 0;
      top: auto;
      border-radius: 14px 14px 0 0;
      transform: translateY(100%);
      transition: transform 0.3s ease;
      z-index: 9999;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    #cartPanel.open, #historyPanel.open {
      transform: translateY(0);
      display: flex !important;
    }
    #cartToggleBtn {
      right: 0;
      top: auto;
      bottom: calc(60vh + 15px);
      border-radius: 12px 0 0 12px;
      padding: 12px 20px;
      z-index: 10000;
    }
    #historyToggleBtn {
      right: auto;
      left: 0;
      bottom: calc(60vh + 15px);
      top: auto;
      border-radius: 0 12px 12px 0;
      padding: 12px 20px;
      z-index: 10000;
    }

    .container {
        margin-top: 20px;
        padding: 20px;
    }

    /* Adjust pet item layout for smaller screens */
    .pet-item, .bundle-item, .recommended-item {
        flex-direction: column;
        text-align: center;
        align-items: center;
        padding: 15px;
        max-width: 100%;
    }

    .pet-info {
        text-align: center;
    }
    .filter-controls {
        flex-direction: column;
        width: 100%;
    }
    .filter-controls input, .filter-controls select {
        width: calc(100% - 18px);
    }
    .rarity-buttons {
        flex-direction: row; /* Keep as row but wrap */
        justify-content: center;
    }
    .modal-content {
      width: 90%;
      padding: 20px;
    }
    .modal-content .close-button {
      top: 10px;
      right: 15px;
      font-size: 30px;
    }
    .modal-content h2 {
      font-size: 24px;
    }
    .modal-content .modal-icon {
      font-size: 60px;
    }
    .modal-content .modal-price {
      font-size: 20px;
    }
    .modal-content button {
      font-size: 16px;
      padding: 10px 20px;
    }
    .toast-notification {
      bottom: 10px;
      right: 10px;
      left: 10px; /* Stretch across the bottom */
      transform: translateY(20px);
    }
    .footer-columns {
        flex-direction: column;
        gap: 20px;
    }
    .footer-column {
        min-width: unset;
        flex: 1 1 auto;
    }
  }
</style>
</head>
<body>

<header>
  Verda4Garden ‚Äì Pets, Sheckles & Sprinkler Available
  <select id="langSelector" aria-label="Pilih Bahasa / Choose Language">
    <option value="id">Bahasa Indonesia</option>
    <option value="en">English</option>
  </select>
  <button id="darkModeToggle" aria-label="Toggle Dark Mode">üåô Dark Mode</button>
</header>

<div class="container">

  <div class="product-section-header">
    <h3 id="petsTitle">Pets Available</h3>
    <div class="filter-controls">
      <input type="text" id="petSearchInput" placeholder="Cari pet..." aria-label="Cari pet">
      </div>
    <div class="rarity-buttons" id="rarityFilterButtons">
      </div>
  </div>
  <div class="pet-list" id="petList"></div>

  <h3 id="shecklesTitle">Sheckles Available</h3>
  <div class="sheckles-list" id="shecklesList"></div>

  ---
  <h3 id="recommendedShecklesTitle">Sheckles Rekomendasi</h3>
  <div class="recommended-list" id="recommendedShecklesList"></div>

  ---
  <h3 id="sprinklerTitle">Sprinkler Available</h3>
  <div class="sprinkler-list" id="sprinklerList"></div>

  ---
  <h3 id="bundleTitle">Paket Bundling</h3>
  <div class="bundle-list" id="bundleList"></div>

  ---

  <h3 id="faqTitle">FAQ (Pertanyaan yang Sering Diajukan)</h3>
  <div id="faqList"></div>

  ---

  <h3 id="testimonialsTitle">Testimoni Pelanggan</h3>
  <div id="testimonialList"></div>

  ---

  <section class="social-media">
    <h3 id="socialMediaTitle">Ikuti Kami!</h3>
    <div class="social-icons">
        <a href="https://discord.gg/r8sQKnmdtg" target="_blank" aria-label="Discord"><i class="fab fa-discord"></i></a>
        <a href="https://www.instagram.com/verda4garden?igsh=YXQwNnlicTZsdHpl" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="https://x.com/growagardenrblx" target="_blank" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
        </div>
  </section>

</div>

<button id="cartToggleBtn" aria-expanded="false" aria-controls="cartPanel" aria-label="Toggle keranjang belanja">
  üõí <span id="cartButtonText">Keranjang</span> (<span id="cartItemCount">0</span>)
</button>
<button id="historyToggleBtn" aria-expanded="false" aria-controls="historyPanel" aria-label="Toggle riwayat pembelian">üìú Riwayat</button>

<aside id="cartPanel" role="region" aria-label="Keranjang belanja">
  <h3 id="cartTitle">Keranjang</h3>
  <div id="cartItems">Keranjang kosong</div>
  <div id="discountDisplay" style="display:none;"></div>
  <div id="cartTotal">Total: Rp 0</div>

  <form id="checkoutForm" aria-label="Formulir checkout">
    <label for="buyerName" id="labelBuyerName">Nama ROBLOX <span style="color:red;">*</span></label>
    <input type="text" id="buyerName" name="buyerName" required placeholder="USN roblox" autocomplete="name" />
    <div id="buyerNameError" class="error-message">Nama minimal 3 karakter.</div>

    <label for="paymentMethod" id="labelPaymentMethod">Metode Pembayaran <span style="color:red;">*</span></label>
    <select id="paymentMethod" name="paymentMethod" required>
      <option value="" disabled selected>Pilih metode pembayaran</option>
      </select>
    <div id="paymentMethodError" class="error-message">Pilih metode pembayaran.</div>

    <label for="promoCode" id="labelPromoCode">Kode Promo</label>
    <input type="text" id="promoCode" name="promoCode" placeholder="Masukkan kode promo" autocomplete="off" />
    <div id="promoCodeMessage" class="error-message" style="display:none;"></div>

    <label for="ratingSelect" id="labelRating">Rating</label>
    <select id="ratingSelect" name="ratingSelect">
      <option value="">Pilih rating (opsional)</option>
      </select>

    <label for="buyerNote" id="labelBuyerNote">Catatan (opsional)</label>
    <textarea id="buyerNote" name="buyerNote" rows="2" placeholder="Contoh: minta yang gemuk kak"></textarea>

    <button type="submit" id="checkoutBtn" disabled>Checkout via WhatsApp</button>
  </form>
</aside>

<aside id="historyPanel" role="region" aria-label="Riwayat pembelian">
  <h3>Riwayat Pembelian</h3>
  <div id="historyItems">Belum ada riwayat pembelian.</div>
</aside>

<div id="addToCartPopup" class="add-to-cart-popup">
  <span class="icon">‚úÖ</span> <span id="popupMessage"></span>
</div>

<div id="productDetailModal" class="modal">
  <div class="modal-content">
    <span class="close-button">&times;</span>
    <div class="modal-icon"></div>
    <h2 class="modal-name"></h2>
    <p class="modal-description"></p>
    <div class="modal-price"></div>
    <button class="add-to-cart-modal-btn"></button>
  </div>
</div>

<div id="checkoutProgress" class="checkout-progress">
  Proses checkout akan dialihkan ke WhatsApp. Mohon tunggu...
</div>

<div id="toastNotification" class="toast-notification"></div>

<button onclick="topFunction()" id="backToTopBtn" title="Kembali ke Atas">‚Üë Atas</button>

<footer class="footer-section">
  <div class="footer-columns">
    <div class="footer-column">
      <h4>Kontak Kami</h4>
      <ul>
        <li><i class="fab fa-whatsapp"></i> WhatsApp: +62 85651205765</li>
        <li><i class="fas fa-envelope"></i> Email: verda4garden@email.com</li>
      </ul>
    </div>
    <div class="footer-column">
      <h4>Jam Operasional</h4>
      <ul>
        <li>Senin - Minggu: 08.00 - 22.00 WITA</li>
        <li>(Terkadang bisa lebih cepat atau lambat)</li>
      </ul>
    </div>
    <div class="footer-column">
      <h4>Informasi</h4>
      <ul>
        <li><a href="#faqList">FAQ</a></li>
        <li><a href="#">Kebijakan Privasi</a></li>
        <li><a href="#">Syarat & Ketentuan</a></li>
      </ul>
    </div>
  </div>
  <div class="footer-bottom">
    &copy; <span id="currentYear"></span> Verda4Garden. All rights reserved.
  </div>
</footer>


<script>
  console.log("Script initiated."); // First log in the script

  const allProducts = {
    // Pets
    DB: { emoji: "üêùüéâ", price: 80000, category: "pet", rarity: "Divine" },
    QB: { emoji: "üëëüêù", price: 30000, category: "pet", rarity: "Divine" },
    Redfox: { emoji: "ü¶ä", price: 15000, category: "pet", rarity: "Mythical" },
    "Red Fox (Random)": { emoji: "ü¶ä", price: 10000, category: "pet", rarity: "Mythical" },
    Mantis10: { emoji: "ü¶ó", price: 5000, category: "pet", rarity: "Mythical" },
    Mantis30: { emoji: "ü¶ó", price: 10000, category: "pet", rarity: "Mythical" },
    Seal: { emoji: "ü¶≠", price: 10000, category: "pet", rarity: "Rare" },
    Macaw: { emoji: "ü¶ú‚ù§Ô∏è", price: 30000, category: "pet", rarity: "Paradise" },
    Moon: { emoji: "üåïüê±", price: 5000, category: "pet", rarity: "Legendary" },
    Blood: { emoji: "ü¶âü©∏", price: 15000, category: "pet", rarity: "Mythical" },
    Night: { emoji: "üåôü¶â", price: 10000, category: "pet", rarity: "Night" },
    Owl: { emoji: "ü¶â", price: 10000, category: "pet", rarity: "Mythical" },
    Peacock: { emoji: "ü¶ö", price: 15000, category: "pet", rarity: "Paradise" },
    Dragonfly: { emoji: "üêâü™∞", price: 55000, category: "pet", rarity: "Rare" },
    Raccoon: { emoji: "ü¶ù", price: 85000, category: "pet", rarity: "Rare" },
    Butterfly: { emoji: "ü¶ã", price: 70000, category: "pet", rarity: "Rare" },
    MimicOctopus: { emoji: "üêô", price: 100000, category: "pet", rarity: "Mythical" },

    // Sheckles
    sheckles1_8t: { emoji: "üí∞", price: 3000, category: "sheckles" },
    sheckles2_7t: { emoji: "üí∞", price: 5000, category: "sheckles" },
    sheckles3_6t: { emoji: "üí∞", price: 8000, category: "sheckles" },
    sheckles4_5t: { emoji: "üí∞", price: 10000, category: "sheckles" },

    // Sprinkler
    sprinklerFullPackage: { emoji: "üí¶", price: 15000, category: "sprinkler" },

    // Bundles
    bundleA: { price: 120000, category: "bundle" },
    bundleB: { price: 40000, category: "bundle" },
    bundleC: { price: 22000, category: "bundle" }
  };

  // Define recommended sheckles
  const recommendedSheckles = ["sheckles4_5t", "sheckles3_6t"];


  let currentLang = 'id';

  const translations = {
    id: {
      petsTitle: "Pets Tersedia",
      shecklesTitle: "Sheckles Tersedia",
      recommendedShecklesTitle: "Sheckles Rekomendasi",
      sprinklerTitle: "Sprinkler Tersedia",
      bundleTitle: "Paket Bundling",
      cartTitle: "Keranjang",
      emptyCart: "Keranjang kosong",
      totalText: "Subtotal",
      discountText: "Diskon Promo",
      finalTotalText: "Total Akhir",
      buyerNameLabel: "Nama ROBLOX",
      paymentMethodLabel: "Metode Pembayaran",
      promoCodeLabel: "Kode Promo",
      ratingLabel: "Rating",
      noteLabel: "Catatan (opsional)",
      checkoutBtn: "Checkout via WhatsApp",
      paymentMethods: ["Pilih metode pembayaran", "GoPay", "Dana", "ShopeePay", "QRIS (scan di linktree)", "COD (Cash on Delivery)"],
      promoInvalid: "Kode promo tidak valid",
      promoExpired: "Kode promo sudah kadaluarsa.",
      promoLimitReached: "Kode promo sudah mencapai batas penggunaan.",
      promoLimitPerUser: (limit) => `Anda sudah menggunakan kode promo ini ${limit} kali.`,
      promoApplied: "Kode promo berhasil diterapkan!",
      ratingOptions: ["Pilih rating (opsional)", "1 ‚òÖ", "2 ‚òÖ‚òÖ", "3 ‚òÖ‚òÖ‚òÖ", "4 ‚òÖ‚òÖ‚òÖ‚òÖ", "5 ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ"],
      checkoutConfirm: "Apakah Anda yakin ingin checkout?",
      historyTitle: "Riwayat Pembelian",
      historyEmpty: "Belum ada riwayat pembelian.",
      langLabel: "Pilih Bahasa",
      cartToggleLabel: "Toggle keranjang belanja",
      historyToggleLabel: "Toggle riwayat pembelian",
      addToCartSuccess: (itemName) => `${itemName} ditambahkan ke keranjang!`,
      searchPlaceholder: "Cari pet...",
      filterAllRarities: "Semua Kelangkaan",
      faqTitle: "FAQ (Pertanyaan yang Sering Diajukan)",
      testimonialsTitle: "Testimoni Pelanggan",
      socialMediaTitle: "Ikuti Kami!",
      cartButtonText: "Keranjang",
      darkModeToggle: "üåô Dark Mode",
      lightModeToggle: "‚òÄÔ∏è Light Mode",
      modalAddToCartBtn: "Tambah ke Keranjang",
      modalCloseBtn: "Tutup",
      checkoutProgress: "Proses checkout akan dialihkan ke WhatsApp. Mohon tunggu...",
      toastSuccess: (msg) => `‚úÖ ${msg}`,
      toastError: (msg) => `‚ùå ${msg}`,
      toastInfo: (msg) => `‚ÑπÔ∏è ${msg}`,
      footerContact: "Kontak Kami",
      footerHours: "Jam Operasional",
      footerInfo: "Informasi",
      footerHoursDetail: "Senin - Minggu: 08.00 - 22.00 WITA (Terkadang bisa lebih cepat atau lambat)",

      pets: {
        DB: { name: "Disco Bee", rarity: "Divine", desc: "Setiap ~20 menit, memiliki peluang 12.28% untuk mengaktifkan mutasi Disco (nilai 125x) pada buah terdekat." },
        QB: { name: "Queen Bee", rarity: "Divine", desc: "Setiap ~25 menit, menerapkan mutasi Pollinated pada buah di sekitar dan mengatur ulang cooldown kemampuan pet lain." },
        Redfox: { name: "Red Fox", rarity: "Mythical", desc: "Mencuri (mendupilasi) benih dari kebun pemain lain (khusus dari Seed Shop)." },
        "Red Fox (Random)": { name: "Red Fox (Random)", rarity: "Mythical", desc: "Mencuri (mendupilasi) benih dari kebun pemain lain (khusus dari Seed Shop)." },
        Mantis10: { name: "Praying Mantis (10+)", rarity: "Mythical", desc: "Memicu mutasi umum (Gold, Rainbow, Shocked, dll.), membuat hasil panen lebih berharga." },
        Mantis30: { name: "Praying Mantis (30+)", rarity: "Mythical", desc: "Memicu mutasi umum (Gold, Rainbow, Shocked, dll.), membuat hasil panen lebih berharga." },
        Seal: { name: "Seal", rarity: "Rare", desc: "Saat menjual pet, memiliki peluang 2% untuk mendapatkan kembali pet tersebut dalam bentuk telur." },
        Macaw: { name: "Scarlet Macaw", rarity: "Paradise", desc: "Memiliki peluang 15.95% untuk memutasi buah Anda menjadi varian Verdant (nilai 4x) setiap 11.50 menit." },
        Moon: { name: "Moon Cat", rarity: "Legendary", desc: "Meningkatkan ukuran buah (1.51x) dalam jarak kecil saat tidur setiap 1 menit. Juga membantu buah tipe Moon (Moon Mango, dll.) tetap di pohon setelah dipanen." },
        Blood: { name: "Blood Owl", rarity: "Mythical", desc: "Membuat semua pet aktif Anda menua lebih cepat (mendapatkan XP lebih banyak)." },
        Night: { name: "Night Owl", rarity: "Night", desc: "Memberikan tambahan XP kepada semua pet aktif sebesar 0.05 hingga 0.25 per detik." },
        Owl: { name: "Owl", rarity: "Mythical", desc: "Memberikan tambahan 0.22 XP/detik kepada semua pet." },
        Peacock: { name: "Peacock", rarity: "Paradise", desc: "Mengurangi cooldown kemampuan pet aktif (info lebih detail belum ditemukan)." },
        Dragonfly: { name: "Dragonfly", rarity: "Rare", desc: "Memberikan mutasi Gold pada buah acak setiap 5 menit (nilai 20x lebih tinggi)." },
        Raccoon: { name: "Raccoon", rarity: "Rare", desc: "Memberikan buah gratis setiap 15 menit dengan mengkloning buah dari kebun tetangga." },
        Butterfly: { name: "Butterfly", rarity: "Rare", desc: "Menerapkan mutasi Rainbow (50x) pada tanaman dengan 5 mutasi setiap 30 menit (melewati yang difavoritkan)." },
        MimicOctopus: { name: "Mimic Octopus", rarity: "Mythical", desc: "Meniru kemampuan pet aktif lainnya. Terbaik saat dipasangkan dengan pet S-tier lainnya." }
      },
      sheckles: {
        sheckles1_8t: "Sheckles 1.8t",
        sheckles2_7t: "Sheckles 2.7t",
        sheckles3_6t: "Sheckles 3.6t",
        sheckles4_5t: "Sheckles 4.5t"
      },
      sprinkler: {
        sprinklerFullPackage: "Sprinkler Full Package"
      },
      bundles: {
        bundleA: { name: "Bundle A", desc: "1 DB + 1 QB + 1 Redfox" },
        bundleB: { name: "Bundle B", desc: "2 Mantis (10+) + 1 Seal + 1 Macaw" },
        bundleC: { name: "Bundle B", desc: "3 Sheckles (3.6t) + 1 Sprinkler" }
      },
      faqs: [
        { q: "Bagaimana cara membeli di sini?", a: "Pilih item yang Anda inginkan, tambahkan ke keranjang, isi detail di formulir checkout, lalu klik tombol WhatsApp untuk melanjutkan pembayaran dan pengiriman." },
        { q: "Metode pembayaran apa saja yang diterima?", a: "Kami menerima pembayaran melalui GoPay, Dana, ShopeePay, QRIS, dan COD (Cash on Delivery)." },
        { q: "Berapa lama proses pengiriman item?", a: "Pengiriman item biasanya diproses dalam 5-15 menit setelah pembayaran dikonfirmasi, tergantung antrean." },
        { q: "Apakah ada garansi jika item tidak diterima?", a: "Tentu, jika ada kendala dalam pengiriman item, kami akan membantu memverifikasi dan memastikan Anda menerima pesanan atau pengembalian dana sesuai kebijakan." }
      ],
      testimonials: [
        { quote: "Pelayanan cepat dan ramah! Pet yang saya beli sesuai deskripsi, sangat direkomendasikan.", author: "Arif, Pembeli Disco Bee" },
        { quote: "Top up sheckles di sini selalu instan, jadi bisa langsung beli-beli di game.", author: "Budi, Pembeli Sheckles" },
        { quote: "Awalnya ragu, tapi ternyata prosesnya mudah dan aman. Pasti beli lagi!", author: "Citra, Pembeli Bundle C" }
      ]
    },
    en: {
      petsTitle: "Pets Available",
      shecklesTitle: "Sheckles Available",
      recommendedShecklesTitle: "Recommended Sheckles",
      sprinklerTitle: "Sprinkler Available",
      bundleTitle: "Bundle Packages",
      cartTitle: "Cart",
      emptyCart: "Cart is empty",
      totalText: "Subtotal",
      discountText: "Promo Discount",
      finalTotalText: "Final Total",
      buyerNameLabel: "Roblox Username",
      paymentMethodLabel: "Payment Method",
      promoCodeLabel: "Promo Code",
      ratingLabel: "Rating",
      noteLabel: "Note (optional)",
      checkoutBtn: "Checkout via WhatsApp",
      paymentMethods: ["Select payment method", "GoPay", "Dana", "ShopeePay", "QRIS (scan on linktree)", "COD (Cash on Delivery)"],
      promoInvalid: "Invalid promo code",
      promoExpired: "Promo code has expired.",
      promoLimitReached: "Promo code has reached its usage limit.",
     promoLimitPerUser: (limit) => `You have already used this promo code ${limit} times.`,
promoApplied: "Promo code applied successfully!",
ratingOptions: ["Select rating (optional)", "1 ‚òÖ", "2 ‚òÖ‚òÖ", "3 ‚òÖ‚òÖ‚òÖ", "4 ‚òÖ‚òÖ‚òÖ‚òÖ", "5 ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ"],
checkoutConfirm: "Are you sure you want to checkout?",
      historyTitle: "Purchase History",
      historyEmpty: "No purchase history yet.",
      langLabel: "Choose Language",
      cartToggleLabel: "Toggle shopping cart",
      historyToggleLabel: "Toggle purchase history",
      addToCartSuccess: (itemName) => `${itemName} added to cart!`,
      searchPlaceholder: "Search pets...",
      filterAllRarities: "All Rarities",
      faqTitle: "FAQ (Frequently Asked Questions)",
      testimonialsTitle: "Customer Testimonials",
      socialMediaTitle: "Follow Us!",
      cartButtonText: "Cart",
      darkModeToggle: "üåô Dark Mode",
      lightModeToggle: "‚òÄÔ∏è Light Mode",
      modalAddToCartBtn: "Add to Cart",
      modalCloseBtn: "Close",
      checkoutProgress: "Checkout process will redirect to WhatsApp. Please wait...",
      toastSuccess: (msg) => `‚úÖ ${msg}`,
      toastError: (msg) => `‚ùå ${msg}`,
      toastInfo: (msg) => `‚ÑπÔ∏è ${msg}`,
      footerContact: "Contact Us",
      footerHours: "Operating Hours",
      footerInfo: "Information",
      footerHoursDetail: "Monday - Sunday: 08:00 AM - 10:00 PM WITA (Sometimes earlier or later)",

      pets: {
        DB: { name: "Disco Bee", rarity: "Divine", desc: "Every ~20 minutes, has a 12.28% chance to activate a Disco mutation (125x value) on nearby fruits." },
        QB: { name: "Queen Bee", rarity: "Divine", desc: "Every ~25 minutes, applies Pollinated mutation to surrounding fruits and resets the highest cooldown pet ability." },
        Redfox: { name: "Red Fox", rarity: "Mythical", desc: "Steals (duplicates) seeds from other players' farms (Seed Shop only)." },
        "Red Fox (Random)": { name: "Red Fox (Random)", rarity: "Mythical", desc: "Steals (duplicates) seeds from other players' farms (Seed Shop only)." },
        Mantis10: { name: "Praying Mantis (10+)", rarity: "Mythical", desc: "Triggers common mutations (Gold, Rainbow, Shocked, etc.), making crops more valuable." },
        Mantis30: { name: "Praying Mantis (30+)", rarity: "Mythical", desc: "Triggers common mutations (Gold, Rainbow, Shocked, etc.), making crops more valuable." },
        Seal: { name: "Seal", rarity: "Rare", desc: "When selling a pet, has a 2% chance to get the pet back as an egg." },
        Macaw: { name: "Scarlet Macaw", rarity: "Paradise", desc: "Has a 15.95% chance to mutate your fruit into a Verdant variant (4x value) every 11.50 minutes." },
        Moon: { name: "Moon Cat", rarity: "Legendary", desc: "Increases fruit size (1.51x) within a small range while napping every 1 minute. Also helps Moon-type fruits (Moon Mango, etc.) stay on the plant after picking." },
        Blood: { name: "Blood Owl", rarity: "Mythical", desc: "Makes all your active pets age faster (gain more XP)." },
        Night: { name: "Night Owl", rarity: "Night", desc: "Grants 0.05 to 0.25 additional XP/second to all active pets." },
        Owl: { name: "Owl", rarity: "Mythical", desc: "Grants 0.22 additional XP/second to all pets." },
        Peacock: { name: "Peacock", rarity: "Paradise", desc: "Reduces the cooldown of active pet abilities (more details not found)." },
        Dragonfly: { name: "Dragonfly", rarity: "Rare", desc: "Gives a guaranteed Gold plant every 5 minutes (worth 20x more)." },
        Raccoon: { name: "Raccoon", rarity: "Rare", desc: "Gives free fruit every 15 minutes by cloning one from a neighbor's garden." },
        Butterfly: { name: "Butterfly", rarity: "Rare", desc: "Applies Rainbow mutation (50x) to plants with five mutations every 30 minutes (skips favorited ones)." },
        MimicOctopus: { name: "Mimic Octopus", rarity: "Mythical", desc: "Mimics the ability of an active pet. Best when paired with other S-tier animals." }
      },
      sheckles: {
        sheckles1_8t: "Sheckles 1.8t",
        sheckles2_7t: "Sheckles 2.7t",
        sheckles3_6t: "Sheckles 3.6t",
        sheckles4_5t: "Sheckles 4.5t"
      },
      sprinkler: {
        sprinklerFullPackage: "Sprinkler Full Package"
      },
      bundles: {
        bundleA: { name: "Bundle A", desc: "1 DB + 1 QB + 1 Redfox" },
        bundleB: { name: "Bundle B", desc: "2 Mantis (10+) + 1 Seal + 1 Macaw" },
        bundleC: { name: "Bundle C", desc: "3 Sheckles (3.6t) + 1 Sprinkler" }
      },
      faqs: [
        { q: "How to buy here?", a: "Select the item you want, add it to the cart, fill in the details in the checkout form, then click the WhatsApp button to proceed with payment and delivery." },
        { q: "What payment methods are accepted?", a: "We accept payments via GoPay, Dana, ShopeePay, QRIS, and COD (Cash on Delivery)." },
        { q: "How long does it take to deliver items?", a: "Item delivery is usually processed within 5-15 minutes after payment confirmation, depending on the queue." },
        { q: "Is there a guarantee if the item is not received?", a: "Certainly, if there are issues with item delivery, we will help verify and ensure you receive your order or a refund according to policy." }
      ],
      testimonials: [
        { quote: "Fast and friendly service! The pet I bought matched the description, highly recommended.", author: "Arif, Disco Bee Buyer" },
        { quote: "Topping up sheckles here is always instant, so I can immediately buy things in-game.", author: "Budi, Sheckles Buyer" },
        { quote: "Initially hesitant, but it turned out to be an easy and safe process. Will definitely buy again!", author: "Citra, Bundle C Buyer" }
      ]
    }
  };

  const promoCodes = {
    "SAVE10": {
      discount: 0.20,
      expires: "2025-07-31T23:59:59",
      usageLimit: 50,
      usedCount: 0,
      perUserLimit: 1
    },
    "HEMAT20": {
      discount: 0.10,
      expires: "2025-08-15T23:59:59",
      usageLimit: 3,
      usedCount: 0,
      perUserLimit: 1
    },
    "123456": {
      discount: 0.10,
      expires: "2025-12-31T23:59:59",
      usageLimit: 2,
      usedCount: 0,
      perUserLimit: 1
    }
  };

  let cart = [];
  let purchaseHistory = [];
  let promoUsage = {};
  let darkMode = false;
  let currentFilterRarity = ""; // For rarity filter buttons

  const soundAdd = new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");
  const soundRemove = new Audio("https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg");
  const soundCheckout = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
  const soundToast = new Audio("https://actions.google.com/sounds/v1/ui/nudge.ogg");


  // Declare DOM elements globally, but assign inside DOMContentLoaded
  let langSelector, darkModeToggle, cartToggleBtn, historyToggleBtn, cartPanel, historyPanel,
      checkoutForm, buyerNameInput, paymentMethodSelect, promoCodeInput, checkoutBtn,
      buyerNameError, paymentMethodError, addToCartPopup, popupMessage, petSearchInput,
      petRarityFilter, petListContainer, shecklesListContainer, sprinklerListContainer,
      bundleListContainer, recommendedShecklesListContainer, cartItemsContainer, cartTotalDisplay,
      discountDisplay, promoCodeMessage, socialMediaTitle, productDetailModal, modalCloseButton,
      modalIcon, modalName, modalDescription, modalPrice, modalAddToCartBtn, checkoutProgress,
      toastNotification, rarityFilterButtons, backToTopBtn;


  console.log("Global DOM variables declared. Waiting for DOMContentLoaded...");

  // Load state from localStorage
  function loadState() {
    console.log("-> loadState() started.");
    const savedCart = localStorage.getItem('cart');
    if (savedCart) {
      cart = JSON.parse(savedCart);
      console.log("Cart loaded:", cart.length, "items.");
    }
    const savedHistory = localStorage.getItem('purchaseHistory');
    if (savedHistory) {
      purchaseHistory = JSON.parse(savedHistory);
      console.log("History loaded:", purchaseHistory.length, "entries.");
    }
    const savedPromoUsage = localStorage.getItem('promoUsage');
    if (savedPromoUsage) {
      promoUsage = JSON.parse(savedPromoUsage);
      console.log("Promo usage loaded.");
    }
    const savedPromoCodes = localStorage.getItem('promoCodes');
    if (savedPromoCodes) {
        const loadedPromoCodes = JSON.parse(savedPromoCodes);
        Object.keys(promoCodes).forEach(code => {
            if (loadedPromoCodes[code]) {
                promoCodes[code].usedCount = loadedPromoCodes[code].usedCount;
            }
        });
        console.log("Promo codes usage counts loaded.");
    }

    const savedLang = localStorage.getItem('currentLang');
    if (savedLang && translations[savedLang]) {
        currentLang = savedLang;
        console.log("Language loaded:", currentLang);
    }

    const savedDarkMode = localStorage.getItem('darkMode');
    if (savedDarkMode === 'true') {
        darkMode = true;
        document.body.classList.add('dark-mode');
        console.log("Dark mode loaded: ON");
    } else {
        darkMode = false;
        document.body.classList.remove('dark-mode');
        console.log("Dark mode loaded: OFF");
    }
    console.log("<- loadState() finished.");
  }

  // Save state to localStorage
  function saveState() {
    console.log("-> saveState() started.");
    localStorage.setItem('cart', JSON.stringify(cart));
    localStorage.setItem('purchaseHistory', JSON.stringify(purchaseHistory));
    localStorage.setItem('promoUsage', JSON.stringify(promoUsage));
    localStorage.setItem('promoCodes', JSON.stringify(promoCodes));
    console.log("<- saveState() finished.");
  }

  // Format price
  function formatPrice(num) {
    if (currentLang === 'id') {
      return 'Rp ' + num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    } else {
      const dollar = num / 15000; // Assuming 1 USD = 15000 IDR
      return '$' + dollar.toFixed(2);
    }
  }

  // Populate dynamic content based on selected language
  function applyTranslations() {
    console.log("-> applyTranslations() started for language:", currentLang);

    // Update static text content
    const elementsToTranslate = [
      { id: 'petsTitle', text: 'petsTitle' },
      { id: 'shecklesTitle', text: 'shecklesTitle' },
      { id: 'recommendedShecklesTitle', text: 'recommendedShecklesTitle' },
      { id: 'sprinklerTitle', text: 'sprinklerTitle' },
      { id: 'bundleTitle', text: 'bundleTitle' },
      { id: 'cartTitle', text: 'cartTitle' },
      { id: 'labelBuyerName', html: true, text: 'buyerNameLabel' },
      { id: 'labelPaymentMethod', html: true, text: 'paymentMethodLabel' },
      { id: 'labelPromoCode', text: 'promoCodeLabel' },
      { id: 'labelRating', text: 'ratingLabel' },
      { id: 'labelBuyerNote', text: 'noteLabel' },
      { id: 'checkoutBtn', text: 'checkoutBtn' },
      { id: 'historyPanel', selector: 'h3', text: 'historyTitle' },
      { id: 'faqTitle', text: 'faqTitle' },
      { id: 'testimonialsTitle', text: 'testimonialsTitle' },
      { id: 'socialMediaTitle', text: 'socialMediaTitle' },
      { id: 'cartButtonText', text: 'cartButtonText' },
      { id: 'checkoutProgress', text: 'checkoutProgress' },
      { id: 'currentYear', text: new Date().getFullYear().toString() }
    ];

    elementsToTranslate.forEach(item => {
      let element;
      if (item.selector) {
        element = document.querySelector(`#${item.id} ${item.selector}`);
      } else {
        element = document.getElementById(item.id);
      }
      if (element) {
        if (item.html) {
          element.innerHTML = `${translations[currentLang][item.text]} <span style="color:red;">*</span>`;
        } else {
          element.textContent = translations[currentLang][item.text];
        }
      } else {
        // console.warn(`Element ${item.id} (selector: ${item.selector}) not found for translation.`);
      }
    });

    // Update aria labels
    if (cartToggleBtn) cartToggleBtn.setAttribute('aria-label', translations[currentLang].cartToggleLabel);
    if (historyToggleBtn) historyToggleBtn.setAttribute('aria-label', translations[currentLang].historyToggleLabel);

    // Update placeholder text
    if (petSearchInput) petSearchInput.placeholder = translations[currentLang].searchPlaceholder;

    // Update dark mode button text
    if (darkModeToggle) {
        darkModeToggle.textContent = darkMode ? translations[currentLang].lightModeToggle : translations[currentLang].darkModeToggle;
    }

    // Populate payment methods
    if (paymentMethodSelect) {
        const originalValue = paymentMethodSelect.value; // Keep selected value
        paymentMethodSelect.innerHTML = '';
        translations[currentLang].paymentMethods.forEach((method, index) => {
            const option = document.createElement('option');
            option.value = index === 0 ? "" : method;
            option.textContent = method;
            if (index === 0) {
                option.disabled = true;
            }
            paymentMethodSelect.appendChild(option);
        });
        if (originalValue) {
            paymentMethodSelect.value = originalValue; // Restore selected value
        } else {
            paymentMethodSelect.value = ""; // Ensure placeholder is selected
        }
    }

    // Populate rating options
    const ratingSelect = document.getElementById('ratingSelect');
    if (ratingSelect) {
        const originalRatingValue = ratingSelect.value; // Keep selected rating
        ratingSelect.innerHTML = '';
        translations[currentLang].ratingOptions.forEach((optionText, index) => {
            const option = document.createElement('option');
            option.value = index === 0 ? "" : optionText;
            option.textContent = optionText;
            ratingSelect.appendChild(option);
        });
        if (originalRatingValue) {
            ratingSelect.value = originalRatingValue; // Restore selected rating
        } else {
            ratingSelect.value = ""; // Ensure placeholder is selected
        }
    }

    // Update modal button text
    if (modalAddToCartBtn) modalAddToCartBtn.textContent = translations[currentLang].modalAddToCartBtn;
    if (modalCloseButton) modalCloseButton.title = translations[currentLang].modalCloseBtn;

    // Update footer text
    const footerContact = document.querySelector('.footer-column:nth-child(1) h4');
    if (footerContact) footerContact.textContent = translations[currentLang].footerContact;
    const footerHours = document.querySelector('.footer-column:nth-child(2) h4');
    if (footerHours) footerHours.textContent = translations[currentLang].footerHours;
    const footerHoursDetail = document.querySelector('.footer-column:nth-child(2) ul li:nth-child(1)');
    if (footerHoursDetail) footerHoursDetail.textContent = translations[currentLang].footerHoursDetail.split('(')[0].trim(); // Get only the first part
    const footerHoursNote = document.querySelector('.footer-column:nth-child(2) ul li:nth-child(2)');
    if (footerHoursNote) footerHoursNote.textContent = `(${translations[currentLang].footerHoursDetail.split('(')[1] || ''}`.replace(')', ''); // Get the note part

    const footerInfo = document.querySelector('.footer-column:nth-child(3) h4');
    if (footerInfo) footerInfo.textContent = translations[currentLang].footerInfo;


    renderAllProducts();
    updateCart();
    renderHistory();
    renderFAQ();
    renderTestimonials();
    populateRarityFilterButtons();
    console.log("<- applyTranslations() finished.");
  }

  function getRarityClassName(rarity) {
    if (!rarity) return '';
    return `rarity-${rarity.replace(/\s/g, '')}`;
  }

  function renderAllProducts() {
      console.log("-> renderAllProducts() started.");
      if (!petListContainer || !shecklesListContainer || !sprinklerListContainer || !bundleListContainer || !petSearchInput || !recommendedShecklesListContainer) {
          console.error("Critical product list containers or filter elements not found. Cannot render products.");
          return;
      }
      showSkeletonLoading();

      if (Object.keys(allProducts).length === 0) {
          console.warn("No products defined in allProducts object. Displaying fallback messages.");
          petListContainer.innerHTML = `<p style="text-align: center; color: ${darkMode ? '#aaa' : '#777'};">No products to display.</p>`;
          shecklesListContainer.innerHTML = `<p style="text-align: center; color: ${darkMode ? '#aaa' : '#777'};">No sheckles to display.</p>`;
          recommendedShecklesListContainer.innerHTML = `<p style="text-align: center; color: ${darkMode ? '#aaa' : '#777'};">No recommended sheckles to display.</p>`;
          sprinklerListContainer.innerHTML = `<p style="text-align: center; color: ${darkMode ? '#aaa' : '#777'};">No sprinkler to display.</p>`;
          bundleListContainer.innerHTML = `<p style="text-align: center; color: ${darkMode ? '#aaa' : '#777'};">No bundle packages to display.</p>`;
          hideSkeletonLoading();
          return;
      }

      setTimeout(() => {
          petListContainer.innerHTML = "";
          shecklesListContainer.innerHTML = "";
          recommendedShecklesListContainer.innerHTML = "";
          sprinklerListContainer.innerHTML = "";
          bundleListContainer.innerHTML = "";

          const searchTerm = petSearchInput.value.toLowerCase();
          const filterRarity = currentFilterRarity; // Use currentFilterRarity from buttons

          let petsFound = false;
          let shecklesFound = false;
          let recommendedShecklesFound = false;
          let sprinklersFound = false;
          let bundlesFound = false;

          Object.entries(allProducts).forEach(([id, item]) => {
              let name = "";
              let desc = "";
              let rarity = item.rarity; // Get rarity from allProducts data
              let priceDisplay = formatPrice(item.price);
              let div = document.createElement('div');
              div.tabIndex = 0;
              div.setAttribute('role', 'button');

              const clickHandler = (e) => {
                  const rect = e.currentTarget.getBoundingClientRect();
                  addToCart(id, name, item.price, item.emoji, rect.left, rect.top);
                  showToast(translations[currentLang].toastSuccess(translations[currentLang].addToCartSuccess(name)), 'success');
              };
              const modalHandler = () => showProductDetail(id, name, desc, item.emoji, item.price, rarity, item.category);


              if (item.category === 'pet') {
                  const petTranslation = translations[currentLang].pets[id];
                  if (!petTranslation) { console.warn(`Translation missing for pet ID: ${id}`); return; }
                  name = petTranslation.name;
                  desc = petTranslation.desc;
                  rarity = petTranslation.rarity; // Rarity from translation might be more descriptive

                  const matchesSearch = name.toLowerCase().includes(searchTerm) ||
                                        desc.toLowerCase().includes(searchTerm) ||
                                        rarity.toLowerCase().includes(searchTerm);
                  const matchesRarity = filterRarity === "" || rarity === filterRarity;

                  if (matchesSearch && matchesRarity) {
                      div.className = "pet-item";
                      div.setAttribute('aria-label', `${name}, ${rarity}, ${desc}, ${priceDisplay}. Klik untuk detail.`);
                      div.innerHTML = `
                          <div class="pet-icon">${item.emoji}</div>
                          <div class="pet-info">
                              <strong>${name} <span class="rarity-label ${getRarityClassName(rarity)}">${rarity}</span></strong>
                              <p>${desc}</p>
                              <p><strong>${priceDisplay}</strong></p>
                          </div>
                      `;
                      div.onclick = modalHandler; // Open modal on click
                      div.onkeypress = (e) => {
                          if (e.key === "Enter" || e.key === " ") {
                              e.preventDefault();
                              modalHandler();
                          }
                      };
                      petListContainer.appendChild(div);
                      petsFound = true;
                  }
              } else if (item.category === 'sheckles') {
                  name = translations[currentLang].sheckles[id];
                  if (!name) { console.warn(`Translation missing for sheckles ID: ${id}`); return; }
                  div.className = "pet-item";
                  div.setAttribute('aria-label', `${name}, ${priceDisplay}. Klik untuk detail.`);
                  div.innerHTML = `
                      <div class="pet-icon">${item.emoji}</div>
                      <div class="pet-info">
                          <strong>${name}</strong>
                          <p><strong>${priceDisplay}</strong></p>
                      </div>
                  `;
                  div.onclick = modalHandler;
                  div.onkeypress = (e) => {
                      if (e.key === "Enter" || e.key === " ") {
                          e.preventDefault();
                          modalHandler();
                      }
                  };
                  shecklesListContainer.appendChild(div);
                  shecklesFound = true;

                  if (recommendedSheckles.includes(id)) {
                      const recommendedDiv = document.createElement('div');
                      recommendedDiv.className = "recommended-item pet-item";
                      recommendedDiv.setAttribute('aria-label', `${name}, ${priceDisplay} (Rekomendasi). Klik untuk detail.`);
                      recommendedDiv.innerHTML = `
                          <div class="pet-icon">${item.emoji}</div>
                          <div class="pet-info">
                              <strong>${name}</strong>
                              <p><strong>${priceDisplay}</strong></p>
                          </div>
                      `;
                      recommendedDiv.onclick = modalHandler;
                      recommendedDiv.onkeypress = (e) => {
                          if (e.key === "Enter" || e.key === " ") {
                              e.preventDefault();
                              modalHandler();
                          }
                      };
                      recommendedShecklesListContainer.appendChild(recommendedDiv);
                      recommendedShecklesFound = true;
                  }

              } else if (item.category === 'sprinkler') {
                  name = translations[currentLang].sprinkler[id];
                  if (!name) { console.warn(`Translation missing for sprinkler ID: ${id}`); return; }
                  div.className = "pet-item";
                  div.setAttribute('aria-label', `${name}, ${priceDisplay}. Klik untuk detail.`);
                  div.innerHTML = `
                      <div class="pet-icon">${item.emoji}</div>
                      <div class="pet-info">
                          <strong>${name}</strong>
                          <p><strong>${priceDisplay}</strong></p>
                      </div>
                  `;
                  div.onclick = modalHandler;
                  div.onkeypress = (e) => {
                      if (e.key === "Enter" || e.key === " ") {
                          e.preventDefault();
                          modalHandler();
                      }
                  };
                  sprinklerListContainer.appendChild(div);
                  sprinklersFound = true;
              } else if (item.category === 'bundle') {
                  const bundleTranslation = translations[currentLang].bundles[id];
                  if (!bundleTranslation) { console.warn(`Translation missing for bundle ID: ${id}`); return; }
                  name = bundleTranslation.name;
                  desc = bundleTranslation.desc;
                  div.className = "bundle-item";
                  div.setAttribute('aria-label', `${name}, ${desc}, ${priceDisplay}. Klik untuk detail.`);
                  div.innerHTML = `
                      <div class="bundle-name">${name}</div>
                      <div class="bundle-desc">${desc}</div>
                      <div class="bundle-price">${priceDisplay}</div>
                  `;
                  div.onclick = modalHandler;
                  div.onkeypress = (e) => {
                      if (e.key === "Enter" || e.key === " ") {
                          e.preventDefault();
                          modalHandler();
                      }
                  };
                  bundleListContainer.appendChild(div);
                  bundlesFound = true;
              }
          });

          if (!petsFound) {
              petListContainer.innerHTML = `<p style="text-align: center; color: ${darkMode ? '#aaa' : '#777'};">Tidak ada pet untuk ditampilkan.</p>`;
          }
          if (!shecklesFound) {
              shecklesListContainer.innerHTML = `<p style="text-align: center; color: ${darkMode ? '#aaa' : '#777'};">Tidak ada sheckles untuk ditampilkan.</p>`;
          }
          if (!recommendedShecklesFound) {
              recommendedShecklesListContainer.innerHTML = `<p style="text-align: center; color: ${darkMode ? '#aaa' : '#777'};">Tidak ada sheckles rekomendasi untuk ditampilkan.</p>`;
          }
          if (!sprinklersFound) {
              sprinklerListContainer.innerHTML = `<p style="text-align: center; color: ${darkMode ? '#aaa' : '#777'};">Tidak ada sprinkler untuk ditampilkan.</p>`;
          }
          if (!bundlesFound) {
              bundleListContainer.innerHTML = `<p style="text-align: center; color: ${darkMode ? '#aaa' : '#777'};">Tidak ada paket bundling untuk ditampilkan.</p>`;
          }

          hideSkeletonLoading();
          console.log("<- renderAllProducts() finished.");
      }, 500);
  }

  function populateRarityFilterButtons() {
      console.log("-> populateRarityFilterButtons() started.");
      if (!rarityFilterButtons) {
          console.warn("Rarity filter buttons container not found. Skipping population.");
          return;
      }
      const rarities = new Set();
      Object.values(translations[currentLang].pets).forEach(pet => {
          if (pet.rarity) {
              rarities.add(pet.rarity);
          }
      });

      rarityFilterButtons.innerHTML = ''; // Clear existing buttons

      const allButton = document.createElement('button');
      allButton.textContent = translations[currentLang].filterAllRarities;
      allButton.classList.add('all-rarities-btn');
      if (currentFilterRarity === "") {
          allButton.classList.add('active');
      }
      allButton.onclick = () => {
          currentFilterRarity = "";
          renderAllProducts();
          highlightActiveRarityButton(allButton);
      };
      rarityFilterButtons.appendChild(allButton);

      Array.from(rarities).sort().forEach(rarity => {
          const button = document.createElement('button');
          button.textContent = rarity;
          button.classList.add(getRarityClassName(rarity));
          if (currentFilterRarity === rarity) {
              button.classList.add('active');
          }
          button.onclick = () => {
              currentFilterRarity = rarity;
              renderAllProducts();
              highlightActiveRarityButton(button);
          };
          rarityFilterButtons.appendChild(button);
      });
      console.log("<- populateRarityFilterButtons() finished.");
  }

  function highlightActiveRarityButton(activeButton) {
      if (!rarityFilterButtons) return;
      Array.from(rarityFilterButtons.children).forEach(button => {
          button.classList.remove('active');
      });
      activeButton.classList.add('active');
  }


  function addToCart(id, name, price, emoji, startX, startY) {
    console.log("-> addToCart() called for:", name);
    const existing = cart.find(i => i.id === id);
    if (existing) {
      existing.qty++;
    } else {
      cart.push({id, name, price, qty:1, emoji: emoji});
    }
    if (soundAdd) soundAdd.play();
    showAddToCartPopup(name);
    if (cartToggleBtn) flyItemToCart(emoji, startX, startY); // Only fly if cart button exists
    updateCart();
    saveState();
    console.log("<- addToCart() finished. Cart:", cart);
  }

  function removeFromCart(id) {
    console.log("-> removeFromCart() called for:", id);
    const index = cart.findIndex(i => i.id === id);
    if (index !== -1) {
      if (cart[index].qty > 1) {
        cart[index].qty--;
      } else {
        cart.splice(index, 1);
      }
      if (soundRemove) soundRemove.play();
      updateCart();
      saveState();
    }
    console.log("<- removeFromCart() finished. Cart:", cart);
  }

  function updateCart() {
    console.log("-> updateCart() started.");
    const cartItemCountSpan = document.getElementById('cartItemCount'); // Get it here again for safety

    let totalItemsInCart = cart.reduce((sum, item) => sum + item.qty, 0);
    if (cartItemCountSpan) cartItemCountSpan.textContent = totalItemsInCart;

    if (cart.length === 0) {
      if (cartItemsContainer) cartItemsContainer.textContent = translations[currentLang].emptyCart;
      if (cartTotalDisplay) cartTotalDisplay.textContent = `${translations[currentLang].totalText}: ${formatPrice(0)}`;
      if (discountDisplay) discountDisplay.style.display = "none";
      if (promoCodeMessage) promoCodeMessage.style.display = "none";
      validateForm();
      console.log("Cart is empty. UI updated.");
      return;
    }

    let html = "";
    let subtotalPrice = 0;
    cart.forEach(item => {
      html += `
      <div class="cart-item">
        <div class="cart-item-info">
          <div class="cart-item-name">${item.name}</div>
          <div>Qty: ${item.qty}</div>
          <div>${formatPrice(item.price)} / pcs</div>
        </div>
        <div class="cart-item-controls">
          <button aria-label="Kurangi jumlah ${item.name}" title="Kurangi" onclick="removeFromCart('${item.id}')">‚àí</button>
        </div>
      </div>
      `;
      subtotalPrice += item.price * item.qty;
    });

    let discountAmount = 0;
    let finalPrice = subtotalPrice;
    const promoCode = promoCodeInput ? promoCodeInput.value.trim().toUpperCase() : '';

    if (promoCode && promoCodes[promoCode]) {
      const promo = promoCodes[promoCode];
      const now = new Date();
      const expiryDate = new Date(promo.expires);
      const buyerName = buyerNameInput ? buyerNameInput.value.trim().toLowerCase() : '';
      const userPromoCount = (promoUsage[buyerName] && promoUsage[buyerName][promoCode]) || 0;


      if (now > expiryDate) {
        if (promoCodeMessage) {
            promoCodeMessage.style.display = "block";
            promoCodeMessage.style.color = "red";
            promoCodeMessage.textContent = translations[currentLang].promoExpired;
        }
      } else if (promo.usedCount >= promo.usageLimit) {
        if (promoCodeMessage) {
            promoCodeMessage.style.display = "block";
            promoCodeMessage.style.color = "red";
            promoCodeMessage.textContent = translations[currentLang].promoLimitReached;
        }
      } else if (buyerName && promo.perUserLimit && userPromoCount >= promo.perUserLimit) {
        if (promoCodeMessage) {
            promoCodeMessage.style.display = "block";
            promoCodeMessage.style.color = "red";
            promoCodeMessage.textContent = translations[currentLang].promoLimitPerUser(promo.perUserLimit);
        }
      } else {
        discountAmount = Math.round(subtotalPrice * promo.discount);
        finalPrice = subtotalPrice - discountAmount;
        if (promoCodeMessage) {
            promoCodeMessage.style.display = "block";
            promoCodeMessage.style.color = "green";
            promoCodeMessage.textContent = translations[currentLang].promoApplied;
        }
      }
    } else if (promoCode) {
      if (promoCodeMessage) {
        promoCodeMessage.style.display = "block";
        promoCodeMessage.style.color = "red";
        promoCodeMessage.textContent = translations[currentLang].promoInvalid;
      }
    } else {
      if (promoCodeMessage) promoCodeMessage.style.display = "none";
    }

    if (cartItemsContainer) cartItemsContainer.innerHTML = html;
    // Tampilkan subtotal dulu
    if (cartTotalDisplay) cartTotalDisplay.textContent = `${translations[currentLang].totalText}: ${formatPrice(subtotalPrice)}`;

    if (discountAmount > 0) {
        if (discountDisplay) {
            // Tampilkan diskon dan total akhir terpisah
            discountDisplay.innerHTML = `${translations[currentLang].discountText}: -${formatPrice(discountAmount)}<br>${translations[currentLang].finalTotalText}: ${formatPrice(finalPrice)}`;
            discountDisplay.style.display = "block";
        }
    } else {
        if (discountDisplay) discountDisplay.style.display = "none";
    }
    validateForm();
    console.log("<- updateCart() finished. Total items:", totalItemsInCart);
  }

  function renderHistory() {
    console.log("-> renderHistory() started.");
    const historyItems = document.getElementById('historyItems');
    if (!historyItems) {
        console.warn("History items container not found for rendering.");
        return;
    }

    if (purchaseHistory.length === 0) {
      historyItems.textContent = translations[currentLang].historyEmpty;
      return;
    }

    let html = "";
    purchaseHistory.forEach((item, index) => {
      html += `
        <div class="history-item">
          <strong>Order #${purchaseHistory.length - index}</strong><br>
          Tanggal: ${new Date(item.date).toLocaleString(currentLang === 'id' ? 'id-ID' : 'en-US')}<br>
          Nama ROBLOX: ${item.buyerName}<br>
          Metode Pembayaran: ${item.paymentMethod}<br>
          Total: ${formatPrice(item.total)}<br>
          Items: ${item.items.map(i => {
              let itemName = i.name;
              if (allProducts[i.id]) {
                  if (allProducts[i.id].category === 'pet' && translations[currentLang].pets[i.id]) {
                      itemName = translations[currentLang].pets[i.id].name;
                  } else if (allProducts[i.id].category === 'sheckles' && translations[currentLang].sheckles[i.id]) {
                      itemName = translations[currentLang].sheckles[i.id];
                  } else if (allProducts[i.id].category === 'sprinkler' && translations[currentLang].sprinkler[i.id]) {
                      itemName = translations[currentLang].sprinkler[i.id];
                  } else if (allProducts[i.id].category === 'bundle' && translations[currentLang].bundles[i.id]) {
                      itemName = translations[currentLang].bundles[i.id].name;
                  }
              }
              return `${itemName} (x${i.qty})`;
          }).join(', ')}<br>
          ${item.promoCode ? `Promo: ${item.promoCode} (-${formatPrice(item.discountAmount)})<br>` : ''}
          ${item.rating ? `Rating: ${item.rating}<br>` : ''}
          ${item.note ? `Catatan: ${item.note}<br>` : ''}
        </div>
      `;
    });
    historyItems.innerHTML = html;
    console.log("<- renderHistory() finished.");
  }

  function renderFAQ() {
    console.log("-> renderFAQ() started.");
    const faqList = document.getElementById('faqList');
    if (!faqList) {
        console.warn("FAQ list container not found for rendering.");
        return;
    }
    faqList.innerHTML = '';
    translations[currentLang].faqs.forEach((faq, index) => {
      const faqItem = document.createElement('div');
      faqItem.className = 'faq-item';
      faqItem.innerHTML = `
        <div class="faq-question" tabindex="0" role="button" aria-expanded="false" aria-controls="faq-answer-${index}">
            <span>${faq.q}</span>
            <span class="toggle-icon">‚ñº</span>
        </div>
        <div id="faq-answer-${index}" class="faq-answer" role="region" aria-hidden="true">
            <p>${faq.a}</p>
        </div>
      `;
      faqList.appendChild(faqItem);

      const questionDiv = faqItem.querySelector('.faq-question');
      const answerDiv = faqItem.querySelector('.faq-answer');

      const toggleFaq = () => {
          const isActive = questionDiv.classList.toggle('active');
          answerDiv.classList.toggle('open', isActive);
          questionDiv.setAttribute('aria-expanded', isActive);
          answerDiv.setAttribute('aria-hidden', !isActive);
      };

      questionDiv.addEventListener('click', toggleFaq);
      questionDiv.addEventListener('keypress', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              toggleFaq();
          }
      });
    });
    console.log("<- renderFAQ() finished.");
  }

  function renderTestimonials() {
    console.log("-> renderTestimonials() started.");
    const testimonialList = document.getElementById('testimonialList');
    if (!testimonialList) {
        console.warn("Testimonial list container not found for rendering.");
        return;
    }
    testimonialList.innerHTML = '';
    translations[currentLang].testimonials.forEach(testimonial => {
      const testimonialItem = document.createElement('div');
      testimonialItem.className = 'testimonial-item';
      testimonialItem.innerHTML = `<blockquote>"${testimonial.quote}"</blockquote><cite>‚Äî ${testimonial.author}</cite>`;
      testimonialList.appendChild(testimonialItem);
    });
    console.log("<- renderTestimonials() finished.");
  }

  function validateForm() {
    console.log("-> validateForm() started.");
    // Pastikan semua elemen DOM yang dibutuhkan ada sebelum diakses
    if (!buyerNameInput || !paymentMethodSelect || !promoCodeInput || !buyerNameError || !paymentMethodError || !promoCodeMessage || !checkoutBtn) {
        console.error("One or more required form elements are missing. Cannot validate form.");
        return false; // Kembali false jika elemen penting tidak ditemukan
    }

    const buyerName = buyerNameInput.value.trim();
    const paymentMethod = paymentMethodSelect.value;
    const promoCode = promoCodeInput.value.trim().toUpperCase();

    let isValid = true;

    // Validasi Nama ROBLOX
    if (buyerName.length < 3) {
        buyerNameInput.classList.add('error');
        buyerNameError.style.display = 'block';
        isValid = false;
    } else {
        buyerNameInput.classList.remove('error');
        buyerNameError.style.display = 'none';
    }

    // Validasi Metode Pembayaran
    if (paymentMethod === "" || paymentMethod === translations[currentLang].paymentMethods[0]) {
        paymentMethodSelect.classList.add('error');
        paymentMethodError.style.display = 'block';
        isValid = false;
    } else {
        paymentMethodSelect.classList.remove('error');
        paymentMethodError.style.display = 'none';
    }

    // Validasi Kode Promo
    if (promoCode) {
        if (!promoCodes[promoCode]) {
            promoCodeInput.classList.add('error');
            promoCodeMessage.style.display = "block";
            promoCodeMessage.style.color = "red";
            promoCodeMessage.textContent = translations[currentLang].promoInvalid;
            isValid = false;
        } else {
            const promo = promoCodes[promoCode];
            const now = new Date();
            const expiryDate = new Date(promo.expires);
            const userPromoCount = (promoUsage[buyerName.toLowerCase()] && promoUsage[buyerName.toLowerCase()][promoCode]) || 0;

            if (now > expiryDate) {
                promoCodeInput.classList.add('error');
                promoCodeMessage.style.display = "block";
                promoCodeMessage.style.color = "red";
                promoCodeMessage.textContent = translations[currentLang].promoExpired;
                isValid = false;
            } else if (promo.usedCount >= promo.usageLimit) {
                promoCodeInput.classList.add('error');
                promoCodeMessage.style.display = "block";
                promoCodeMessage.style.color = "red";
                promoCodeMessage.textContent = translations[currentLang].promoLimitReached;
                isValid = false;
            } else if (promo.perUserLimit && userPromoCount >= promo.perUserLimit) {
                promoCodeInput.classList.add('error');
                promoCodeMessage.style.display = "block";
                promoCodeMessage.style.color = "red";
                promoCodeMessage.textContent = translations[currentLang].promoLimitPerUser(promo.perUserLimit);
                isValid = false; // Mark as invalid if per-user limit reached
            } else {
                // Promo valid, hapus kelas error dan tampilkan pesan sukses
                promoCodeInput.classList.remove('error');
                promoCodeMessage.style.display = "block";
                promoCodeMessage.style.color = "green"; // Warna hijau untuk promo berhasil
                promoCodeMessage.textContent = translations[currentLang].promoApplied;
            }
        }
    } else {
        // Jika promoCode kosong, hapus error dan sembunyikan pesan
        promoCodeInput.classList.remove('error');
        promoCodeMessage.style.display = "none";
    }

    // Pastikan keranjang tidak kosong
    if (cart.length === 0) {
        isValid = false;
        console.log("Cart is empty, form invalid.");
        // Anda bisa tambahkan pesan visual di sini jika mau, misal:
        // if (cartItemsContainer) cartItemsContainer.textContent = "Keranjang kosong, tidak bisa checkout.";
    }

    // Atur status tombol checkout
    checkoutBtn.disabled = !isValid;
    console.log("<- validateForm() finished. Form valid:", isValid);
    return isValid;
  }

  function checkout(event) {
    // Pastikan event.preventDefault() selalu dipanggil untuk mencegah pengiriman form standar
    event.preventDefault();
    console.log("-> checkout() initiated.");

    // Panggil validateForm() untuk memastikan semua input valid sebelum melanjutkan
    if (!validateForm()) {
        showToast(translations[currentLang].toastError("Harap lengkapi semua bidang yang wajib diisi dan perbaiki kesalahan yang ada."), 'error');
        console.log("Checkout aborted due to validation errors.");
        return; // Hentikan proses jika validasi gagal
    }

    if (!confirm(translations[currentLang].checkoutConfirm)) {
        console.log("Checkout aborted by user confirmation.");
        return;
    }

    if (soundCheckout) soundCheckout.play();

    const buyerName = buyerNameInput ? buyerNameInput.value.trim() : '';
    const paymentMethod = paymentMethodSelect ? paymentMethodSelect.value : '';
    const promoCode = promoCodeInput ? promoCodeInput.value.trim().toUpperCase() : '';
    const ratingElement = document.getElementById('ratingSelect');
    const rating = ratingElement ? ratingElement.value : '';
    const buyerNoteElement = document.getElementById('buyerNote');
    const buyerNote = buyerNoteElement ? buyerNoteElement.value.trim() : '';

    let subtotalPrice = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
    let discountAmount = 0;
    let finalPrice = subtotalPrice; // Initialize finalPrice here

    if (promoCode && promoCodes[promoCode]) {
        const promo = promoCodes[promoCode];
        const now = new Date();
        const expiryDate = new Date(promo.expires);
        const userPromoCount = (promoUsage[buyerName.toLowerCase()] && promoUsage[buyerName.toLowerCase()][promoCode]) || 0;

        // Double-check promo validity here again, as validateForm() might not prevent all edge cases
        if (now <= expiryDate && promo.usedCount < promo.usageLimit && (!promo.perUserLimit || userPromoCount < promo.perUserLimit)) {
            discountAmount = Math.round(subtotalPrice * promo.discount);
            finalPrice = subtotalPrice - discountAmount; // Calculate final price after discount

            promoCodes[promoCode].usedCount++;
            if (!promoUsage[buyerName.toLowerCase()]) {
                promoUsage[buyerName.toLowerCase()] = {};
            }
            promoUsage[buyerName.toLowerCase()][promoCode] = (promoUsage[buyerName.toLowerCase()][promoCode] || 0) + 1;

            console.log(`Promo code ${promoCode} applied. Discount: ${discountAmount}. New usage count: ${promoCodes[promoCode].usedCount}`);
        } else {
            // This case should ideally be caught by validateForm, but as a fallback
            showToast(translations[currentLang].toastError("Kode promo tidak dapat digunakan. Harap periksa kembali."), 'error');
            updateCart(); // Update UI if promo becomes invalid during checkout
            console.log("Promo code deemed invalid during final checkout check.");
            return;
        }
    }

    let message = `Halo, saya ingin memesan:\n\n`;
    cart.forEach(item => {
        let translatedName = item.name;
        // Logic untuk translasi nama item
        if (allProducts[item.id]) {
            if (allProducts[item.id].category === 'pet' && translations[currentLang].pets[item.id]) {
                translatedName = translations[currentLang].pets[item.id].name;
            } else if (allProducts[item.id].category === 'sheckles' && translations[currentLang].sheckles[item.id]) {
                translatedName = translations[currentLang].sheckles[item.id];
            } else if (allProducts[item.id].category === 'sprinkler' && translations[currentLang].sprinkler[item.id]) {
                translatedName = translations[currentLang].sprinkler[item.id];
            } else if (allProducts[item.id].category === 'bundle' && translations[currentLang].bundles[item.id]) {
                translatedName = translations[currentLang].bundles[item.id].name;
            }
        }
        message += `- ${translatedName} (x${item.qty}) - ${formatPrice(item.price * item.qty)}\n`;
    });
    message += `\nSubtotal: ${formatPrice(subtotalPrice)}\n`;

    if (discountAmount > 0) {
      message += `${translations[currentLang].discountText}: -${formatPrice(discountAmount)}\n`;
      message += `${translations[currentLang].finalTotalText}: ${formatPrice(finalPrice)}\n`;
    } else {
      message += `${translations[currentLang].totalText}: ${formatPrice(finalPrice)}\n`; // Use finalPrice here
    }

    message += `\nNama ROBLOX: ${buyerName}\n`;
    message += `Metode Pembayaran: ${paymentMethod}\n`;
    if (rating) {
      message += `Rating: ${rating}\n`;
    }
    if (buyerNote) {
      message += `Catatan: ${buyerNote}\n`;
    }
    message += `\nMohon diproses segera. Terima kasih!`;

    // Show checkout progress message
    if (checkoutProgress) checkoutProgress.classList.add('show');
    showToast(translations[currentLang].toastInfo(translations[currentLang].checkoutProgress), 'info', 5000);

    const whatsappUrl = `https://wa.me/6285651205765?text=${encodeURIComponent(message)}`;

    purchaseHistory.unshift({
      date: new Date().toISOString(),
      buyerName: buyerName,
      paymentMethod: paymentMethod,
      total: finalPrice, // Store final price in history
      items: cart.map(item => ({ id: item.id, name: item.name, qty: item.qty })),
      promoCode: promoCode || null,
      discountAmount: discountAmount,
      rating: rating || null,
      note: buyerNote || null
    });

    cart = [];
    if (checkoutForm) checkoutForm.reset();
    updateCart();
    renderHistory();
    saveState();

    // Delay opening WhatsApp slightly to allow toast to appear
    setTimeout(() => {
        window.open(whatsappUrl, '_blank');
        if (checkoutProgress) checkoutProgress.classList.remove('show');
        console.log("<- Checkout complete, WhatsApp opened.");
    }, 1500); // 1.5 second delay
  }

  // Add to cart popup animation
  let popupTimeout;
  function showAddToCartPopup(itemName) {
      if (!addToCartPopup || !popupMessage) {
          console.warn("Add to cart popup elements not found for display.");
          return;
      }
      popupMessage.textContent = translations[currentLang].addToCartSuccess(itemName);
      addToCartPopup.classList.add('show');
      clearTimeout(popupTimeout);
      popupTimeout = setTimeout(() => {
          addToCartPopup.classList.remove('show');
      }, 3000);
  }

  // Flying item animation
  function flyItemToCart(emoji, startX, startY) {
    if (!cartToggleBtn) {
        console.warn("Cart toggle button not found for flying animation.");
        return;
    }
    const flyingItem = document.createElement('div');
    flyingItem.className = 'flying-item';
    flyingItem.textContent = emoji;
    document.body.appendChild(flyingItem);

    const cartBtnRect = cartToggleBtn.getBoundingClientRect();
    const endX = cartBtnRect.left + (cartBtnRect.width / 2) - 15;
    const endY = cartBtnRect.top + (cartBtnRect.height / 2) - 15;

    flyingItem.style.left = `${startX}px`;
    flyingItem.style.top = `${startY}px`;

    setTimeout(() => {
        flyingItem.style.transform = `translate(${endX - startX}px, ${endY - startY}px) scale(0.5)`;
        flyingItem.style.opacity = '0';
    }, 10);

    flyingItem.addEventListener('transitionend', () => {
        flyingItem.remove();
    });
  }

  // Skeleton Loading functions
  function showSkeletonLoading() {
      console.log("-> showSkeletonLoading() started.");
      // Clear existing content immediately to show skeletons
      // Ensure containers exist before clearing
      if (petListContainer) petListContainer.innerHTML = '';
      if (shecklesListContainer) shecklesListContainer.innerHTML = '';
      if (recommendedShecklesListContainer) recommendedShecklesListContainer.innerHTML = '';
      if (sprinklerListContainer) sprinklerListContainer.innerHTML = '';
      if (bundleListContainer) bundleListContainer.innerHTML = '';

      // Only inject skeleton if the container exists
      if (petListContainer) petListContainer.innerHTML = Array(6).fill().map(() => `
          <div class="skeleton-item">
              <div class="skeleton-icon"></div>
              <div class="skeleton-line title"></div>
              <div class="skeleton-line desc" style="width: 90%;"></div>
              <div class="skeleton-line desc" style="width: 70%;"></div>
              <div class="skeleton-line price"></div>
          </div>
      `).join('');

      if (shecklesListContainer) shecklesListContainer.innerHTML = Array(4).fill().map(() => `
          <div class="skeleton-item">
              <div class="skeleton-icon"></div>
              <div class="skeleton-line title"></div>
              <div class="skeleton-line price"></div>
          </div>
      `).join('');

      if (recommendedShecklesListContainer) recommendedShecklesListContainer.innerHTML = Array(2).fill().map(() => `
          <div class="skeleton-item">
              <div class="skeleton-icon"></div>
              <div class="skeleton-line title"></div>
              <div class="skeleton-line price"></div>
          </div>
      `).join('');

      if (sprinklerListContainer) sprinklerListContainer.innerHTML = `
          <div class="skeleton-item">
              <div class="skeleton-icon"></div>
              <div class="skeleton-line title"></div>
              <div class="skeleton-line price"></div>
          </div>
      `;

      if (bundleListContainer) bundleListContainer.innerHTML = Array(3).fill().map(() => `
          <div class="skeleton-item bundle">
              <div class="skeleton-line title" style="height: 1.5em; width: 60%;"></div>
              <div class="skeleton-line desc" style="height: 3em; width: 95%;"></div>
              <div class="skeleton-line price" style="margin-top: auto;"></div>
          </div>
      `).join('');
      console.log("<- showSkeletonLoading() finished.");
  }

  function hideSkeletonLoading() {
      // console.log("Hiding skeleton loading (implicitly handled by re-rendering content).");
  }

  // Product Detail Modal functions
  function showProductDetail(id, name, desc, emoji, price, rarity, category) {
      if (!productDetailModal || !modalIcon || !modalName || !modalDescription || !modalPrice || !modalAddToCartBtn) {
          console.error("Modal elements not found. Cannot show product detail.");
          return;
      }
      modalIcon.textContent = emoji;
      modalName.textContent = name;
      modalDescription.textContent = desc || "No description available.";
      modalPrice.textContent = formatPrice(price);

      // Set up "Add to Cart" button in modal
      modalAddToCartBtn.textContent = translations[currentLang].modalAddToCartBtn;
      modalAddToCartBtn.onclick = () => {
          const rect = modalAddToCartBtn.getBoundingClientRect();
          addToCart(id, name, price, emoji, rect.left, rect.top);
          closeProductDetailModal();
      };
      modalAddToCartBtn.setAttribute('data-product-id', id); // Store ID for easy access

      // Add rarity label for pets
      if (category === 'pet' && rarity) {
          modalName.innerHTML = `${name} <span class="rarity-label ${getRarityClassName(rarity)}">${rarity}</span>`;
      } else {
          modalName.innerHTML = name;
      }


      productDetailModal.classList.add('show');
      document.body.style.overflow = 'hidden'; // Prevent scrolling background
  }

  function closeProductDetailModal() {
      if (productDetailModal) {
          productDetailModal.classList.remove('show');
          document.body.style.overflow = ''; // Restore scrolling
      }
  }

  // Toast notification function
  let toastTimeout;
  function showToast(message, type = 'info', duration = 3000) {
      if (!toastNotification) {
          console.warn("Toast notification element not found.");
          return;
      }
      clearTimeout(toastTimeout);
      toastNotification.textContent = message;
      toastNotification.className = 'toast-notification show'; // Reset classes
      toastNotification.classList.add(type); // Add type class for styling

      // Play sound
      if (soundToast) soundToast.play();

      toastTimeout = setTimeout(() => {
          toastNotification.classList.remove('show');
      }, duration);
  }

  // Back to Top functionality
  function topFunction() {
    document.body.scrollTop = 0; // For Safari
    document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
  }

  window.onscroll = function() { scrollFunction() };

  function scrollFunction() {
    if (backToTopBtn) {
        if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
            backToTopBtn.style.display = "block";
        } else {
            backToTopBtn.style.display = "none";
        }
    }
  }


  // Event Listeners
  document.addEventListener('DOMContentLoaded', () => {
    console.log("-> DOMContentLoaded event fired. Initializing main script logic.");

    try {
        // Assign DOM elements to global variables after DOM is ready
        // This is crucial for fixing 'null' errors if elements weren't ready before.
        langSelector = document.getElementById('langSelector');
        darkModeToggle = document.getElementById('darkModeToggle');
        cartToggleBtn = document.getElementById('cartToggleBtn');
        historyToggleBtn = document.getElementById('historyToggleBtn');
        cartPanel = document.getElementById('cartPanel');
        historyPanel = document.getElementById('historyPanel');
        checkoutForm = document.getElementById('checkoutForm');
        buyerNameInput = document.getElementById('buyerName');
        paymentMethodSelect = document.getElementById('paymentMethod');
        promoCodeInput = document.getElementById('promoCode');
        checkoutBtn = document.getElementById('checkoutBtn');
        buyerNameError = document.getElementById('buyerNameError');
        paymentMethodError = document.getElementById('paymentMethodError');
        addToCartPopup = document.getElementById('addToCartPopup');
        popupMessage = document.getElementById('popupMessage');
        petSearchInput = document.getElementById('petSearchInput');
        // petRarityFilter = document.getElementById('petRarityFilter'); // No longer needed
        rarityFilterButtons = document.getElementById('rarityFilterButtons'); // New rarity filter buttons container
        petListContainer = document.getElementById('petList');
        shecklesListContainer = document.getElementById('shecklesList');
        recommendedShecklesListContainer = document.getElementById('recommendedShecklesList'); // Assign recommended container
        sprinklerListContainer = document.getElementById('sprinklerList');
        bundleListContainer = document.getElementById('bundleList');
        cartItemsContainer = document.getElementById('cartItems');
        cartTotalDisplay = document.getElementById('cartTotal');
        discountDisplay = document.getElementById('discountDisplay');
        promoCodeMessage = document.getElementById('promoCodeMessage');
        socialMediaTitle = document.getElementById('socialMediaTitle');
        productDetailModal = document.getElementById('productDetailModal');
        modalCloseButton = document.querySelector('#productDetailModal .close-button');
        modalIcon = document.querySelector('#productDetailModal .modal-icon');
        modalName = document.querySelector('#productDetailModal .modal-name');
        modalDescription = document.querySelector('#productDetailModal .modal-description');
        modalPrice = document.querySelector('#productDetailModal .modal-price');
        modalAddToCartBtn = document.querySelector('#productDetailModal .add-to-cart-modal-btn');
        checkoutProgress = document.getElementById('checkoutProgress');
        toastNotification = document.getElementById('toastNotification');
        backToTopBtn = document.getElementById('backToTopBtn');


        // Set current year in footer
        const currentYearSpan = document.getElementById('currentYear');
        if (currentYearSpan) {
            currentYearSpan.textContent = new Date().getFullYear();
        }

        console.log("All DOM elements reassigned after DOMContentLoaded.");

        loadState();
        applyTranslations();
        updateCart(); // Initial update of cart display and checkout button state
        renderHistory();
        renderFAQ();
        renderTestimonials();
        populateRarityFilterButtons(); // Use new rarity filter buttons

        // Attach event listeners only after elements are confirmed to exist
        if (langSelector) langSelector.addEventListener('change', (event) => {
          currentLang = event.target.value;
          localStorage.setItem('currentLang', currentLang);
          applyTranslations();
        });

        if (darkModeToggle) darkModeToggle.addEventListener('click', () => {
          darkMode = !darkMode;
          document.body.classList.toggle('dark-mode', darkMode);
          localStorage.setItem('darkMode', darkMode);
          // Update text immediately without relying solely on applyTranslations for speed
          darkModeToggle.textContent = darkMode ? translations[currentLang].lightModeToggle : translations[currentLang].darkModeToggle;
        });

        if (cartToggleBtn) cartToggleBtn.addEventListener('click', () => {
          if (cartPanel) cartPanel.classList.toggle('open');
          if (cartToggleBtn && cartPanel) cartToggleBtn.setAttribute('aria-expanded', cartPanel.classList.contains('open'));
          if (historyPanel && historyPanel.classList.contains('open')) {
            historyPanel.classList.remove('open');
            if (historyToggleBtn) historyToggleBtn.setAttribute('aria-expanded', 'false');
          }
        });

        if (historyToggleBtn) historyToggleBtn.addEventListener('click', () => {
          if (historyPanel) historyPanel.classList.toggle('open');
          if (historyToggleBtn && historyPanel) historyToggleBtn.setAttribute('aria-expanded', historyPanel.classList.contains('open'));
          if (cartPanel && cartPanel.classList.contains('open')) {
            cartPanel.classList.remove('open');
            if (cartToggleBtn) cartToggleBtn.setAttribute('aria-expanded', 'false');
          }
        });

        if (checkoutForm) checkoutForm.addEventListener('submit', checkout);

        if (buyerNameInput) buyerNameInput.addEventListener('input', () => {
            validateForm();
            updateCart();
        });

        if (paymentMethodSelect) paymentMethodSelect.addEventListener('change', () => {
            validateForm();
            updateCart();
        });

        if (promoCodeInput) promoCodeInput.addEventListener('input', () => {
            updateCart();
            validateForm();
        });

        // Modal event listeners
        if (modalCloseButton) modalCloseButton.addEventListener('click', closeProductDetailModal);
        if (productDetailModal) productDetailModal.addEventListener('click', (event) => {
            if (event.target === productDetailModal) {
                closeProductDetailModal();
            }
        });
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && productDetailModal && productDetailModal.classList.contains('show')) {
                closeProductDetailModal();
            }
        });

        // Pet search input listener
        if (petSearchInput) petSearchInput.addEventListener('input', () => {
            renderAllProducts();
        });

        console.log("All event listeners attached.");
    } catch (e) {
        console.error("Error during DOMContentLoaded initialization:", e);
        alert("Terjadi kesalahan saat memuat halaman: " + e.message + "\nSilakan periksa konsol browser untuk detail lebih lanjut.");
    }
    console.log("<- DOMContentLoaded event finished.");
  });

</script>
</body>
</html>
